<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Receive and download</title>
</head>
<body>
<h1>Receive a file and download from another peer</h1>
<div>
    Received data:
    <pre id="fileDisplayArea"></pre>
</div>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
<script src="http://cdn.socket.io/socket.io-1.3.7.js"></script>
<script src="peer.js"></script>
<script src="download.js"></script>
<script>
    window.onload = function(){
        var fileDisplayArea = document.getElementById('fileDisplayArea');
        var result = [];
        var i = 0;

        //create PeerJs object receive connection
        var peer = new Peer('100', {host:'localhost', port:9000, debug:3});
        var socket = io.connect('http://localhost:8000');

        peer.on('open', function(){
            console.log(peer.id);

        });

        //receive the connection from another peer

        //Emitted when a new data connection is established from a remote peer
        peer.on('connection',function(conn){
            i += 1;
            console.log(i);
            //Set listeners for data connection events.
            //Emitted when the connection is established and ready-to-use.
            conn.on('open', function(){

                //receive data
                //Emitted when data is received from the remote peer.
                conn.on('data', function(data){
                    // console.log(data);
                    fileDisplayArea.innerText = data;
                    console.log(data.byteLength);
                    result.push(data);
                    //download(file.content,file.fileName, file.fileType);
                    console.log(result);
//                    if (result.length===4){
//                        //console.log(result);
//                        setTimeout(sendSign(result),500);
//                    }
                });
            });
            if (result.length===4){
                //console.log(result);
                setTimeout(sendSign(result),500);
            }

        });

        function sendSign(result){
            console.log('result'+result);
            socket.emit('nextRound','true');
        }

    }
</script>

</body>
</html>